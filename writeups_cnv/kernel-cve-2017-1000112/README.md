# Linux内核漏洞导致容器逃逸（CVE-2017-1000112）

## 场景介绍

请参考Capsule8的[文章](https://capsule8.com/blog/practical-container-escape-exercise/)，下文的PoC同样出自Capsule8。

## 环境搭建

宿主机环境：

- VMware 16.1.0
- Ubuntu 16.04

首先切换内核，直接通过Metarget安装环境

```
./metarget cnv install cve-2017-1000112 --verbose
```

接着部署容器和K8s环境（注意，如果在切换内核前已经部署了K8s，那么切换内核重启后，可能需要执行`swapoff -a`以确保kubelet能够顺利启动）。

基础环境（Docker+K8s）准备（如果已经有任意版本的Docker+K8s环境则可跳过）：

```bash
./metarget gadget install docker --version 18.03.1
./metarget gadget install k8s --version 1.16.5 --domestic
```

## 漏洞复现

预先编译好[poc.c](poc.c)，然后创建容器并复制poc到容器内，执行即可。注意，该poc在容器内会调用`ifconfig`命令，因此需确保在执行poc前容器内该命令可用。